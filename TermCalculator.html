<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MakhanaBazar – Premium Export Quote</title>
<style>
body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f5f8ffa;margin:0;padding:20px}
.container{max-width:980px;margin:20px auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 6px 24px rgba(6,24,44,.08)}
.brandBox{text-align:center;margin-bottom:12px}
.brandBox h1{margin:0;font-size:26px;color:#1e7b34;font-weight:800}
.brandBox p{margin:0;font-size:13px;color:#444}
.title{text-align:center;color:#124a16;font-weight:700;margin-bottom:12px;font-size:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:12px}
.form-group{display:flex;flex-direction:column}
label{font-weight:600;margin-bottom:6px;font-size:13px}
input,select{padding:10px;border-radius:8px;border:1px solid #d0cfcf;font-size:14px}
.noPrint{ }
.buttons{display:flex;justify-content:center;gap:14px;margin:12px 0;flex-wrap:wrap}
.btn{padding:10px 18px;border-radius:10px;border:0;color:#fff;cursor:pointer;font-weight:700;font-size:14px;transition:.18s ease}
.btn.calc{background:#1e7b34}.btn.pdf{background:#4a3bc8}.btn.mail{background:#0a66c2}.btn.reset{background:#b71c1c}
.livePanel{flex:1; background:#ffffff; padding:18px; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,0.06); min-height:200px; border:1px solid #e6e6e6}
#grandTotalLive{font-size:26px;font-weight:800;color:#0e5f1b}
.breakdownTable td{padding:8px;border:1px solid #e6e6e6}
.printArea{display:none}
@media print{body *{visibility:hidden}.printArea, .printArea *{visibility:visible}body{background:#fff}.noPrint{display:none} }
@media (max-width:880px){.sideWrap{flex-wrap:wrap}.grid{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));}}
</style>
</head>
<body>
<div class="container noPrint">
  <div class="brandBox">
    <h1>Krishipurna Organic Pvt. Ltd.</h1>
    <p>Premium Indian Makhana Export | www.makhanabazar.com</p>
  </div>

  <h2 class="title">CIF / FOB / EXW Export Price Calculator</h2>

  <div class="grid">
    <!-- Buyer Details -->
    <div class="form-group"><label>Buyer Name</label><input id="buyerName" type="text" placeholder="Enter Buyer Name"/></div>
    <div class="form-group"><label>Buyer Email</label><input id="buyerEmail" type="email" placeholder="Enter Buyer Email"/></div>

    <div class="form-group"><label>Quantity (KG)</label><input id="kg" type="number" placeholder="e.g. 3000"/></div>
    <div class="form-group"><label>Quality</label>
      <select id="quality">
        <option value="A1" data-price="1300">A1 – Premium</option>
        <option value="A2" data-price="1200">A2 – Standard</option>
        <option value="A3" data-price="1000">A3 – Economy</option>
      </select>
    </div>
    <div class="form-group"><label>Manual Price (INR/kg)</label><input id="manualPrice" type="number" placeholder="Optional - overrides quality price"/></div>
    <div class="form-group"><label>Incoterm</label>
      <select id="incoterm"><option>EXW</option><option>FOB</option><option selected>CIF</option></select>
    </div>
    <div class="form-group"><label>Destination Country</label>
      <select id="destCountry">
        <option value="USA" data-currency="USD" data-rate="88.7420">USA</option>
        <option value="UK" data-currency="GBP" data-rate="116.7194">UK</option>
        <option value="GERMANY" data-currency="EUR" data-rate="103.3188">Germany</option>
        <option value="UAE" data-currency="AED" data-rate="24.14">UAE</option>
        <option value="AUSTRALIA" data-currency="AUD" data-rate="57.83">Australia</option>
        <option value="CANADA" data-currency="CAD" data-rate="63.31">Canada</option>
      </select>
    </div>
    <div class="form-group"><label>Destination Port</label><select id="destPort"></select></div>
    <div class="form-group"><label>Output Currency</label>
      <select id="currencyOnly"><option>USD</option><option>EUR</option><option>GBP</option><option>AED</option><option>AUD</option><option>CAD</option></select>
    </div>
  </div>

  <!-- TOP BUTTONS (Calculate + Reset) -->
  <div class="noPrint buttons" id="topButtons" style="justify-content:center">
    <button class="btn calc" id="calcBtn">Calculate</button>
    <button class="btn reset" id="resetBtn">Reset</button>
  </div>

  <!-- SIDE-BY-SIDE: CALCULATOR (left) + LIVE RESULT (right) -->
  <div class="sideWrap" style="display:flex;gap:16px;flex-wrap:wrap;">
    <!-- left column is the inputs area (already above) - we keep live panel on right -->
    <div class="livePanel" id="liveResult">
      <h3 style="margin-top:0; color:#1e7b34; font-size:18px; text-align:center;">Live Cost Breakdown</h3>

      <!-- GRAND TOTAL BOX -->
      <div id="grandTotalBox" style="background:#f3f8f2;border:1px solid #cbe5c8;padding:12px;border-radius:8px;text-align:center;margin-bottom:12px;">
        <div style="font-size:13px;font-weight:600;color:#124a16;">Grand Total</div>
        <div id="grandTotalLive">--</div>
      </div>

      <!-- BREAKDOWN TABLE -->
      <table id="breakdownTable" class="breakdownTable" style="width:100%;border-collapse:collapse;">
  <tbody id="breakdownBody"></tbody>
</table>
    </div>
  </div>

  <!-- BOTTOM BUTTONS (appear after calculate) -->
  <div class="buttons noPrint" id="bottomButtons" style="display:none; justify-content:center; margin-top:10px;">
    <button class="btn pdf" id="pdfBtn">Download Quote</button>
    <button class="btn mail" id="mailBtn">Send Email</button>
  </div>

  <!-- Terms & Conditions (hidden until calculate) -->
  <h3 id="tcHeader" style="margin-top:18px; text-align:left; color:#1e7b34; display:none;">Terms & Conditions</h3>
  <ul id="tcBox" style="font-size:14px; line-height:1.6; padding-left:18px; display:none;">
    <li><strong>Pricing Basis:</strong> All prices are quoted based on the selected Incoterm (EXW/FOB/CIF).</li>
    <li><strong>Payment Terms:</strong> 100% advance payment unless otherwise agreed in writing.</li>
    <li><strong>Validity:</strong> This quotation is valid for 7 days from the date of issue.</li>
    <li><strong>Delivery Time:</strong> Dispatch within 10–12 business days after payment confirmation.</li>
    <li><strong>Documentation Provided:</strong> Commercial Invoice, Packing List, Fumigation Certificate, Phytosanitary Certificate, Certificate of Origin (on request), and Bill of Lading (after vessel departure).</li>
    <li><strong>Quality Assurance:</strong> Goods are inspected under our internal quality control standards before dispatch.</li>
    <li><strong>Insurance:</strong> For CIF shipments, marine insurance is included as per Incoterms 2020.</li>
    <li><strong>Liability:</strong> Seller is not responsible for delays caused by port congestion, customs, or shipping line issues.</li>
  </ul>

</div>

<!-- PRINT / PDF AREA -->
<div class="printArea" id="printArea">
  <img src="https://i.imgur.com/ODz3R2y.png" style="width:130px;display:block;margin:auto;margin-bottom:10px;" loading="lazy" width="130" height="40"/>
  <h1 style="text-align:center;color:#1e7b34;margin-bottom:4px">Krishipurna Organic Pvt. Ltd.</h1>
  <p style="text-align:center;margin:0 0 12px 0;font-size:13px">Premium Makhana Export | www.makhanabazar.com</p>

  <h3 style="text-align:center;margin:0;">EXPORT QUOTATION</h3>
  <p style="text-align:center;margin:0 0 12px 0;font-size:13px;">Quotation No: <span id="quoteNo"></span> | Date: <span id="quoteDate"></span></p>

  <table style="width:100%;font-size:13px;margin-bottom:12px;">
    <tr><td><strong>Buyer Name:</strong></td><td id="pbName"></td></tr>
    <tr><td><strong>Buyer Email:</strong></td><td id="pbEmail"></td></tr>
  </table>

  <h2 style="text-align:center;margin-bottom:10px">COST SUMMARY</h2>
  <table id="exportTable" style="width:100%;border-collapse:collapse;font-size:13px"></table>

  <h3 style="margin-top:18px;">Terms & Conditions</h3>
  <ul style="font-size:12px;line-height:1.5;">
    <li>Pricing basis as per Incoterm.</li>
    <li>100% advance payment unless otherwise agreed.</li>
    <li>Quotation valid for 7 days.</li>
  </ul>
</div>

<script>
(function(){
  const kgInput=document.getElementById('kg');
  const qualitySel=document.getElementById('quality');
  const manualPriceInput=document.getElementById('manualPrice');
  const incotermSel=document.getElementById('incoterm');
  const destCountry=document.getElementById('destCountry');
  const destPort=document.getElementById('destPort');
  const currencyOnly=document.getElementById('currencyOnly');
  const breakdownBody=document.getElementById('breakdownBody');
  const exportTable=document.getElementById('exportTable');
  const pdfBtn=document.getElementById('pdfBtn');
  const mailBtn=document.getElementById('mailBtn');
  const buyerName=document.getElementById('buyerName');
  const buyerEmail=document.getElementById('buyerEmail');
  const topButtons=document.getElementById('topButtons');
  const bottomButtons=document.getElementById('bottomButtons');
  const tcHeader=document.getElementById('tcHeader');
  const tcBox=document.getElementById('tcBox');
  const grandTotalLive=document.getElementById('grandTotalLive');
  const quoteNo=document.getElementById('quoteNo');
  const quoteDate=document.getElementById('quoteDate');

  const portMap={
    'USA':['New York','Los Angeles','Houston','Savannah','Newark'],
    'UK':['Tilbury','Southampton','London Gateway','Felixstowe','Liverpool'],
    'GERMANY':['Hamburg','Bremerhaven','Wilhelmshaven'],
    'UAE':['Jebel Ali','Abu Dhabi','Sharjah'],
    'AUSTRALIA':['Sydney','Melbourne','Brisbane'],
    'CANADA':['Vancouver','Toronto','Montreal']
  };

  const freightRate={
    'NewYork':3100,'LosAngeles':3500,'Houston':2900,'Savannah':3000,'Newark':3050,
    'Tilbury':2200,'Southampton':2400,'LondonGateway':2300,'Felixstowe':2350,'Liverpool':2500,
    'Hamburg':2000,'Bremerhaven':2100,'Wilhelmshaven':2050,
    'JebelAli':1500,'AbuDhabi':1400,'Sharjah':1300,
    'Sydney':2900,'Melbourne':3100,'Brisbane':3000,
    'Vancouver':2600,'Toronto':2800,'Montreal':2700
  };

  const importCharges={USA:1800,UK:1301,GERMANY:1500,UAE:900,AUSTRALIA:1600,CANADA:1400};

  function loadPorts(){
    const ports=portMap[destCountry.value]||[];
    destPort.innerHTML=ports.map(p=>`<option value="${p}">${p}</option>`).join('');
    currencyOnly.value=destCountry.selectedOptions[0].dataset.currency;
  }
  destCountry.addEventListener('change',loadPorts);loadPorts();

  function calculate(){
    const kg=parseFloat(kgInput.value);
    if(!kg){alert('Enter KG');return;}

    let pricePerKg=parseFloat(qualitySel.selectedOptions[0].dataset.price);
    const manualPrice=parseFloat(manualPriceInput.value);
    if(!isNaN(manualPrice) && manualPrice>0) pricePerKg=manualPrice;

    const USD_INR = 88.7420;
    const inc = incotermSel.value;
    const portKey = destPort.value.replace(/\s+/g,'');
    const dest = destCountry.value;
    const curr = currencyOnly.value;

    // Convert product INR -> USD using USD_INR (always use USD rate)
    const productUSD = (kg * pricePerKg) / USD_INR;
    const exportLocal = 321;
    const indiaTransport = 810;
    const oceanFreight = freightRate[portKey] || 0;
    const importLocal = importCharges[dest] || 0;
    const insurance = inc === 'CIF' ? productUSD * 0.001 : 0;

    let totalUSD = 0;
    if(inc === 'EXW') totalUSD = productUSD;
    if(inc === 'FOB') totalUSD = productUSD + exportLocal;
    if(inc === 'CIF') totalUSD = productUSD + exportLocal + indiaTransport + oceanFreight + importLocal + insurance;

    // Correct currency conversion: USD -> destination currency using INR parity
    const currencyINR = { USD: 88.7420, GBP: 116.7194, EUR: 103.3188, AED: 24.14, AUD: 57.83, CAD: 63.31 };
    let final;
    if(curr === 'USD'){
      final = totalUSD;
    } else {
      final = totalUSD * (currencyINR['USD'] / currencyINR[curr]);
    }

    // Build LIVE BREAKDOWN TABLE (side panel)
    const liveRows=[
      ['Quantity (KG)',kg],
      ['Quality Selected',qualitySel.value],
      ['Price Per KG (INR)',pricePerKg],
      ['Incoterm',inc],
      ['Destination Country',dest],
      ['Destination Port',destPort.value],
      ['Output Currency',curr],
      ['Product Cost (USD)',productUSD.toFixed(2)],
    ];
    if(inc !== 'EXW') liveRows.push(['Export Local Charges (USD)',exportLocal]);
    if(inc === 'CIF'){
      liveRows.push(['Transport India (USD)',indiaTransport]);
      liveRows.push(['Ocean Freight (USD)',oceanFreight]);
      liveRows.push(['Import Local Charges (USD)',importLocal]);
      liveRows.push(['Insurance (USD)',insurance.toFixed(2)]);
    }
    liveRows.push([`GRAND TOTAL (${inc})`,`${final.toFixed(2)} ${curr}`]);

    breakdownBody.innerHTML = liveRows.map(r=>`<tr><td style='padding:6px;font-weight:600;'>${r[0]}</td><td style='padding:6px;'>${r[1]}</td></tr>`).join('');

    // Update Grand Total Live
    grandTotalLive.innerText = `${final.toFixed(2)} ${curr}`;

    // Build Export Table
    const rows=[
      ['Quantity (KG)',kg],
      ['Quality Selected',qualitySel.value],
      ['Price Per KG (INR)',pricePerKg],
      ['Incoterm',inc],
      ['Destination Country',dest],
      ['Destination Port',destPort.value],
      ['Output Currency',curr],
      ['Product Cost (USD)',productUSD.toFixed(2)],
    ];

    if(inc !== 'EXW') rows.push(['Export Local Charges (USD)',exportLocal]);
    if(inc === 'CIF'){
      rows.push(['Transport India (USD)',indiaTransport]);
      rows.push(['Ocean Freight (USD)',oceanFreight]);
      rows.push(['Import Local Charges (USD)',importLocal]);
      rows.push(['Insurance (USD)',insurance.toFixed(2)]);
    }

    rows.push([`GRAND TOTAL (${inc})`,`${final.toFixed(2)} ${curr}`]);

    exportTable.innerHTML = rows.map(r=>`<tr><td style='padding:8px;border:1px solid #ddd;'>${r[0]}</td><td style='padding:8px;border:1px solid #ddd;'>${r[1]}</td></tr>`).join('');

    // Show export buttons and T&C
    bottomButtons.style.display = 'flex';
    tcHeader.style.display = 'block';
    tcBox.style.display = 'block';

    // Update pdf metadata fields
    quoteNo.innerText = 'KPQ-' + Math.floor(Math.random()*90000+10000);
    quoteDate.innerText = new Date().toLocaleDateString();
    document.getElementById('pbName').innerText = buyerName.value || '-';
    document.getElementById('pbEmail').innerText = buyerEmail.value || '-';
  }

  document.getElementById('calcBtn').addEventListener('click',calculate);

  // PDF export using html2pdf (assumes html2pdf is loaded on the page)
  pdfBtn.addEventListener('click',()=>{
    // ensure metadata updated
    quoteNo.innerText = 'KPQ-' + Math.floor(Math.random()*90000+10000);
    quoteDate.innerText = new Date().toLocaleDateString();
    document.getElementById('pbName').innerText = buyerName.value || '-';
    document.getElementById('pbEmail').innerText = buyerEmail.value || '-';

    const element = document.getElementById('printArea');
    const opt = { margin:0.4, filename:'quotation.pdf', html2canvas:{scale:2}, jsPDF:{unit:'in',format:'a4'} };
    if(window.html2pdf){
      html2pdf().set(opt).from(element).save();
    } else {
      alert('PDF export library (html2pdf) not found.');
    }
  });

  // Send email (opens mailto with table body)
  mailBtn.addEventListener('click',()=>{
    const rows = [...exportTable.querySelectorAll('tr')].map(tr => tr.innerText).join('%0A');
    const subject = encodeURIComponent('Export Quotation from Krishipurna Organic');
    const body = encodeURIComponent(rows);
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
  });

  // Reset
  document.getElementById('resetBtn').addEventListener('click',()=>location.reload());

})();
</script>
</body>
</html>
